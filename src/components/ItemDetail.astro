---
import type { ItemWithType } from '../lib/schema';
import { formatCurrency, formatDate, getConditionColor, getProfessionalGradeColor, getImageUrl } from '../lib/utils';

interface Props {
  item: ItemWithType;
}

const { item } = Astro.props;
const imageUrl = getImageUrl(item.image_path, item.collection_type_name);
const editUrl = item.collection_type_name.toLowerCase() === 'cards'
  ? `/cards/${item.id}/edit`
  : `/comics/${item.id}/edit`;
---

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
  <!-- Image Section -->
  <div class="card overflow-hidden">
    <div class="aspect-[3/4] bg-gray-100">
      {item.image_path ? (
        <img
          src={imageUrl}
          alt={item.name}
          class="w-full h-full object-contain"
        />
      ) : (
        <div class="w-full h-full flex items-center justify-center text-gray-400">
          <svg class="w-24 h-24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
        </div>
      )}
    </div>
  </div>

  <!-- Details Section -->
  <div>
    <div class="flex items-start justify-between mb-6">
      <div>
        <span class="badge bg-gray-100 text-gray-600 mb-2">
          {item.collection_type_name}
        </span>
        <h1 class="text-3xl font-bold text-gray-900">{item.name}</h1>
        {item.series && (
          <p class="text-lg text-gray-600 mt-1">
            {item.series} {item.issue_number && `#${item.issue_number}`}
          </p>
        )}
      </div>
      <a href={editUrl} class="btn-secondary">
        <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
        </svg>
        Edit
      </a>
    </div>

    <!-- Key Info Cards -->
    <div class="grid grid-cols-2 gap-4 mb-8">
      <div class="card p-4">
        <span class="text-sm text-gray-500">Estimated Value</span>
        <p class="text-2xl font-bold text-primary-600">
          {formatCurrency(item.estimated_value) || '-'}
        </p>
        {item.value_updated_at && (
          <span class="text-xs text-gray-400">
            Updated {formatDate(item.value_updated_at)}
          </span>
        )}
      </div>

      <div class="card p-4">
        <span class="text-sm text-gray-500">Purchase Price</span>
        <p class="text-2xl font-bold text-gray-900">
          {formatCurrency(item.purchase_price) || '-'}
        </p>
        {item.purchase_date && (
          <span class="text-xs text-gray-400">
            Purchased {formatDate(item.purchase_date)}
          </span>
        )}
      </div>
    </div>

    <!-- Details List -->
    <div class="card divide-y divide-gray-100">
      <div class="p-4 flex justify-between">
        <span class="text-gray-500">Condition</span>
        <span>
          {item.professional_grade ? (
            <span class={`badge ${getProfessionalGradeColor(item.professional_grade)}`}>
              {item.grading_company} {item.professional_grade}
            </span>
          ) : item.condition_grade ? (
            <span class={`badge ${getConditionColor(item.condition_grade)}`}>
              {item.condition_grade}
            </span>
          ) : (
            <span class="text-gray-400">Ungraded</span>
          )}
        </span>
      </div>

      {item.cert_number && (
        <div class="p-4 flex justify-between">
          <span class="text-gray-500">Certification #</span>
          <span class="font-mono">{item.cert_number}</span>
        </div>
      )}

      {item.publisher && (
        <div class="p-4 flex justify-between">
          <span class="text-gray-500">Publisher</span>
          <span>{item.publisher}</span>
        </div>
      )}

      {item.year && (
        <div class="p-4 flex justify-between">
          <span class="text-gray-500">Year</span>
          <span>{item.year}</span>
        </div>
      )}

      {item.variant && (
        <div class="p-4 flex justify-between">
          <span class="text-gray-500">Variant</span>
          <span>{item.variant}</span>
        </div>
      )}

      <div class="p-4 flex justify-between">
        <span class="text-gray-500">Added</span>
        <span>{formatDate(item.created_at)}</span>
      </div>
    </div>

    {item.notes && (
      <div class="mt-6">
        <h3 class="section-title mb-2">Notes</h3>
        <div class="card p-4">
          <p class="text-gray-700 whitespace-pre-wrap">{item.notes}</p>
        </div>
      </div>
    )}
  </div>
</div>
