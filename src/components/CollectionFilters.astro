---
import { CONDITION_GRADES } from '@/lib/schema';

interface Props {
  baseUrl: string;
  years: number[];
  q?: string;
  condition?: string;
  minValue?: string;
  maxValue?: string;
  year?: string;
}

const { baseUrl, years, q = '', condition = '', minValue = '', maxValue = '', year = '' } = Astro.props;

const hasActiveFilters = condition || minValue || maxValue || year;
---

<form method="get" action={baseUrl} class="space-y-4">
  <div class="flex flex-col sm:flex-row gap-3">
    <div class="flex-1">
      <label for="search" class="sr-only">Search</label>
      <div class="relative">
        <svg class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-brown/50" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <input
          type="text"
          id="search"
          name="q"
          value={q}
          placeholder="Search by name, publisher, series..."
          class="input pl-12"
        />
      </div>
    </div>
    <button type="submit" class="btn-primary whitespace-nowrap">
      <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg>
      Search
    </button>
  </div>

  <details class="group card-flat p-4" open={hasActiveFilters}>
    <summary class="cursor-pointer text-sm font-display font-semibold text-navy hover:text-teal flex items-center gap-2 transition-colors">
      <svg class="w-4 h-4 transition-transform group-open:rotate-90" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
      </svg>
      Filters
      {hasActiveFilters && (
        <span class="badge-gold text-xs">Active</span>
      )}
    </summary>

    <div class="mt-4 pt-4 border-t-2 border-dashed border-brown/20 grid grid-cols-2 sm:grid-cols-4 gap-4">
      <div>
        <label for="condition" class="label">Condition</label>
        <select id="condition" name="condition" class="input">
          <option value="">Any</option>
          {CONDITION_GRADES.map((grade) => (
            <option value={grade} selected={condition === grade}>
              {grade}
            </option>
          ))}
        </select>
      </div>

      <div>
        <label for="minValue" class="label">Min Value ($)</label>
        <input
          type="number"
          id="minValue"
          name="minValue"
          value={minValue}
          min="0"
          step="0.01"
          placeholder="0"
          class="input"
        />
      </div>

      <div>
        <label for="maxValue" class="label">Max Value ($)</label>
        <input
          type="number"
          id="maxValue"
          name="maxValue"
          value={maxValue}
          min="0"
          step="0.01"
          placeholder="Any"
          class="input"
        />
      </div>

      <div>
        <label for="year" class="label">Year</label>
        <select id="year" name="year" class="input">
          <option value="">Any</option>
          {years.map((y) => (
            <option value={y} selected={year === y.toString()}>
              {y}
            </option>
          ))}
        </select>
      </div>
    </div>

    {hasActiveFilters && (
      <div class="mt-4 pt-3 border-t-2 border-dashed border-brown/20">
        <a
          href={baseUrl}
          class="inline-flex items-center gap-2 text-sm text-rust hover:text-rust-dark font-semibold transition-colors"
        >
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
          Clear all filters
        </a>
      </div>
    )}
  </details>
</form>
